<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPH-TI | ë‚˜ì˜ ë³´ê±´í•™ì  ì„±í–¥ ì°¾ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #e0f2fe 100%);
            min-height: 100vh;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }
        .progress-bar { transition: width 0.4s ease-in-out; }
        .option-btn { transition: all 0.2s ease; }
        .option-btn:hover { transform: translateY(-2px); background-color: #f1f5f9; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .kakao-btn { background-color: #FEE500; color: #191919; }
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <div id="app" class="w-full max-w-lg glass-card rounded-3xl overflow-hidden min-h-[650px] flex flex-col relative">
        
        <!-- Start Screen -->
        <div id="start-screen" class="p-8 flex flex-col items-center justify-center flex-grow text-center">
            <div class="w-20 h-20 bg-sky-100 rounded-full flex items-center justify-center mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-sky-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-slate-800 mb-2 tracking-tight">MPH-TI</h1>
            <p class="text-sky-600 font-semibold mb-6 uppercase text-sm tracking-wider">ë‚˜ì˜ ë³´ê±´í•™ì  ì„±í–¥ ì§„ë‹¨</p>
            
            <div class="w-full mb-8">
                <label class="block text-left text-xs font-bold text-slate-400 mb-2 ml-1">ì„±í•¨ ë˜ëŠ” ë‹‰ë„¤ì„</label>
                <input type="text" id="user-nickname" placeholder="ì‹¤ëª…ì„ ì…ë ¥í•´ì£¼ì‹œë©´ ì •ë¦¬ê°€ í¸í•´ìš”!" 
                    class="w-full p-4 rounded-2xl border-2 border-slate-100 focus:border-sky-500 outline-none transition-all text-center font-bold text-slate-700">
            </div>

            <button onclick="startQuiz()" class="w-full py-4 bg-sky-600 hover:bg-sky-700 text-white font-bold rounded-2xl shadow-lg transition-all transform hover:scale-[1.02]">
                ì§„ë‹¨ ì‹œì‘í•˜ê¸°
            </button>
            <p class="mt-6 text-[10px] text-slate-400">Â© 2026 ê°€í†¨ë¦­ëŒ€í•™êµ ë³´ê±´í•™ê³¼ ì›ìš°íšŒ</p>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden flex flex-col h-full">
            <div class="p-6 bg-white border-b border-slate-100">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-xs font-bold text-sky-600 uppercase tracking-wider">ì§ˆë¬¸ <span id="current-idx">1</span> / 12</span>
                </div>
                <div class="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                    <div id="progress" class="progress-bar h-full bg-sky-500 w-0"></div>
                </div>
            </div>
            <div class="p-8 flex-grow flex flex-col justify-center">
                <h2 id="question-text" class="text-xl font-bold text-slate-800 mb-10 leading-snug animate-fade-in"></h2>
                <div id="options-container" class="space-y-3"></div>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden p-6 flex flex-col items-center animate-fade-in overflow-y-auto">
            <div id="capture-area" class="w-full p-6 mb-6 border border-slate-100 shadow-sm relative overflow-hidden bg-white rounded-2xl">
                <div class="text-center relative z-10">
                    <p class="text-sky-600 font-bold text-xs mb-1" id="res-user-name"></p>
                    <h3 class="text-slate-300 font-bold text-[9px] mb-3 uppercase tracking-widest">MPH-TI Official Report</h3>
                    <div id="result-icon" class="text-5xl mb-3"></div>
                    <h2 id="result-title" class="text-2xl font-black text-sky-700 mb-1"></h2>
                    <p id="result-subtitle" class="text-slate-500 text-sm font-medium mb-4"></p>
                    <div id="result-desc" class="bg-sky-50/50 p-4 rounded-xl text-left text-xs leading-relaxed text-slate-600 mb-6 border border-sky-100/50"></div>
                    <div class="grid grid-cols-2 gap-3 mb-2">
                        <div class="bg-white/80 p-2 rounded-lg border border-slate-100 text-center"><p class="text-[9px] text-slate-400 font-bold uppercase">EPI</p><span id="score-epi" class="text-lg font-bold text-slate-700">0</span></div>
                        <div class="bg-white/80 p-2 rounded-lg border border-slate-100 text-center"><p class="text-[9px] text-slate-400 font-bold uppercase">STAT</p><span id="score-stat" class="text-lg font-bold text-slate-700">0</span></div>
                        <div class="bg-white/80 p-2 rounded-lg border border-slate-100 text-center"><p class="text-[9px] text-slate-400 font-bold uppercase">POL</p><span id="score-pol" class="text-lg font-bold text-slate-700">0</span></div>
                        <div class="bg-white/80 p-2 rounded-lg border border-slate-100 text-center"><p class="text-[9px] text-slate-400 font-bold uppercase">FIELD</p><span id="score-field" class="text-lg font-bold text-slate-700">0</span></div>
                    </div>
                </div>
            </div>
            
            <div class="w-full space-y-2">
                <button onclick="downloadImage()" class="w-full py-3.5 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-2xl shadow-md flex items-center justify-center transition-all text-sm">ì´ë¯¸ì§€ë¡œ ì €ì¥</button>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="copyToClipboard()" class="py-3 bg-slate-100 text-slate-600 font-bold rounded-xl text-xs transition-all">ìš”ì•½ ë³µì‚¬</button>
                    <button onclick="location.reload()" class="py-3 bg-white border border-slate-200 text-slate-400 font-bold rounded-xl text-xs transition-all">ë‹¤ì‹œ í•˜ê¸°</button>
                </div>
                <div id="save-status" class="text-[10px] text-center text-slate-400 mt-4">ë°ì´í„° ì €ì¥ ì¤‘...</div>
            </div>
        </div>

        <!-- Toast -->
        <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full text-sm opacity-0 transition-opacity pointer-events-none z-[100]"></div>
    </div>

    <script>
        // â˜…â˜…â˜… 1ë‹¨ê³„ì—ì„œ ë³µì‚¬í•œ êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ URLì„ ì—¬ê¸°ì— ë„£ìœ¼ì„¸ìš” â˜…â˜…â˜…
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxzhaQQ-xgiWh-j5PMwe88AnydLUndlXtkdu8gRQD_S_YHZ6JDMEzYXE5OzuoPTxX77Nw/exec";
        
        // Kakao Init
        const KAKAO_KEY = '719277d3b0638573216091219808381d'; 
        try { if (window.Kakao && !Kakao.isInitialized()) Kakao.init(KAKAO_KEY); } catch(e) {}

        let nickname = "";
        let currentStep = 0;
        let scores = { EPI: 0, STAT: 0, POL: 0, FIELD: 0 };
        let finalResultData = {};

        const questions = [
            { id: 'E1', type: 'EPI', text: "ì—°êµ¬ì„¤ê³„(ì½”í˜¸íŠ¸, ë‹¨ë©´ì—°êµ¬ ë“±)ì— ê´€ì‹¬ì´ ìˆë‹¤." },
            { id: 'E2', type: 'EPI', text: "ë…¼ë¬¸ì„ ì½ìœ¼ë©° ë³€ìˆ˜ ê°„ ê´€ê³„ë¥¼ í•´ì„í•˜ëŠ” ê²ƒì´ ì¬ë¯¸ìˆë‹¤." },
            { id: 'E3', type: 'EPI', text: "ì¸ê³¼ì„±, êµë€ë³€ìˆ˜, ë°”ì´ì–´ìŠ¤ ê°œë…ì´ ìµìˆ™í•˜ë‹¤." },
            { id: 'S1', type: 'STAT', text: "í†µê³„ í”„ë¡œê·¸ë¨(SAS, R, SPSS ë“±)ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í¸í•˜ë‹¤." },
            { id: 'S2', type: 'STAT', text: "ë°ì´í„° ë¶„ì„ ê²°ê³¼ë¥¼ ì‹œê°í™”í•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•œë‹¤." },
            { id: 'S3', type: 'STAT', text: "ë¶„ì„ëª¨í˜•ì„ ì„¤ì •í•˜ëŠ” ê³¼ì •ì´ ì¦ê²ë‹¤." },
            { id: 'P1', type: 'POL', text: "ë³´ê±´ ì •ì±…ì´ë‚˜ ë²•Â·ì œë„ ë³€í™”ì— ê´€ì‹¬ì´ ë§ë‹¤." },
            { id: 'P2', type: 'POL', text: "ì‚¬ì—… ê¸°íš ë˜ëŠ” ì •ì±… ë³´ê³ ì„œ ì‘ì„± ê²½í—˜ì´ ìˆë‹¤." },
            { id: 'P3', type: 'POL', text: "ì—°êµ¬ ê²°ê³¼ì˜ ì •ì±… í™œìš© ê°€ëŠ¥ì„±ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•œë‹¤." },
            { id: 'F1', type: 'FIELD', text: "ë³´ê±´ì†ŒÂ·ë³‘ì›Â·ì§€ì—­ì‚¬íšŒ ì‚¬ì—… ë“± í˜„ì¥ ê²½í—˜ì´ ìˆë‹¤." },
            { id: 'F2', type: 'FIELD', text: "ì‚¬ëŒë“¤ê³¼ ì§ì ‘ ì†Œí†µí•˜ëŠ” í™œë™ì´ í¸í•˜ë‹¤." },
            { id: 'F3', type: 'FIELD', text: "ì—°êµ¬ë³´ë‹¤ ì‹¤ë¬´ ì ìš© ê°€ëŠ¥ì„±ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” í¸ì´ë‹¤." }
        ];

        const typeDetails = {
            'EPI': { name: 'ì—­í•™ ì¤‘ì‹¬í˜•', icon: 'ğŸ”¬', desc: 'ì§ˆë³‘ì˜ ì›ì¸ê³¼ ì—°êµ¬ ì„¤ê³„ì˜ ì™„ë²½í•¨ì„ ì¶”êµ¬í•©ë‹ˆë‹¤.' },
            'STAT': { name: 'í†µê³„ ì¤‘ì‹¬í˜•', icon: 'ğŸ“Š', desc: 'ë°ì´í„°ì˜ íŒ¨í„´ê³¼ ë¶„ì„ ëª¨í˜•ì˜ ì •êµí•¨ì„ ì¦ê¹ë‹ˆë‹¤.' },
            'POL': { name: 'ì •ì±… ì¤‘ì‹¬í˜•', icon: 'ğŸ›ï¸', desc: 'ì—°êµ¬ê°€ ì œë„ë¡œ ì´ì–´ì§€ëŠ” ê±°ì‹œì  ë³€í™”ì— ì§‘ì¤‘í•©ë‹ˆë‹¤.' },
            'FIELD': { name: 'í˜„ì¥ ì¤‘ì‹¬í˜•', icon: 'ğŸ¥', desc: 'í˜„ì¥ì˜ ëª©ì†Œë¦¬ì™€ ì‹¤ì§ˆì ì¸ ì‚¬ì—… ì ìš©ì„ ì¤‘ì‹œí•©ë‹ˆë‹¤.' }
        };

        window.startQuiz = () => {
            nickname = document.getElementById('user-nickname').value.trim();
            if (!nickname) { showToast("ì„±í•¨ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!"); return; }
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
            renderQuestion();
        };

        function renderQuestion() {
            const q = questions[currentStep];
            document.getElementById('current-idx').innerText = currentStep + 1;
            document.getElementById('progress').style.width = ((currentStep + 1) / questions.length * 100) + '%';
            document.getElementById('question-text').innerText = q.text;
            
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            [5, 4, 3, 2, 1].forEach(val => {
                const labels = ["ë§¤ìš° ê·¸ë ‡ë‹¤", "ê·¸ë ‡ë‹¤", "ë³´í†µ", "ì•„ë‹ˆë‹¤", "ì „í˜€ ì•„ë‹ˆë‹¤"];
                const btn = document.createElement('button');
                btn.className = "option-btn w-full p-4 text-left border-2 border-slate-100 rounded-2xl flex items-center group bg-white";
                btn.onclick = () => handleAnswer(val);
                btn.innerHTML = `<span class="w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-xs font-bold mr-4 group-hover:bg-sky-100 transition-colors">${val}</span><span class="font-medium text-sm text-slate-700">${labels[5-val]}</span>`;
                container.appendChild(btn);
            });
        }

        async function handleAnswer(val) {
            scores[questions[currentStep].type] += val;
            if (currentStep < questions.length - 1) {
                currentStep++; renderQuestion();
            } else { await showResult(); }
        }

        async function showResult() {
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('res-user-name').innerText = `${nickname} ì›ìš°ë‹˜ì˜ MPH-TI ê²°ê³¼`;
            document.getElementById('score-epi').innerText = scores.EPI;
            document.getElementById('score-stat').innerText = scores.STAT;
            document.getElementById('score-pol').innerText = scores.POL;
            document.getElementById('score-field').innerText = scores.FIELD;

            const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
            const top = sorted[0], second = sorted[1];
            let title, icon, subtitle = "";

            if (top[1] - second[1] <= 2) {
                title = `${top[0]}-${second[0]} í˜¼í•©í˜•`;
                icon = "âœ¨"; subtitle = "ë‹¤ì–‘í•œ ë³´ê±´í•™ì  ì‹œê°ì„ ê²¸ë¹„í•œ ìœµí•©í˜• ì¸ì¬";
            } else {
                title = typeDetails[top[0]].name;
                icon = typeDetails[top[0]].icon;
                subtitle = typeDetails[top[0]].desc;
            }

            document.getElementById('result-icon').innerText = icon;
            document.getElementById('result-title').innerText = title;
            document.getElementById('result-subtitle').innerText = subtitle;
            document.getElementById('result-desc').innerHTML = `ë‹¹ì‹ ì€ ë³´ê±´í•™ í•™ë¬¸ì˜ ê¸¸ì—ì„œ <b>${title}</b>ì˜ ë©´ëª¨ë¥¼ ê°€ì¥ ëšœë ·í•˜ê²Œ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤.`;

            finalResultData = { title, nickname };
            saveToGoogleSheet();
        }

        // êµ¬ê¸€ ì‹œíŠ¸ ì €ì¥ ë¡œì§
        function saveToGoogleSheet() {
            const statusElem = document.getElementById('save-status');
            const data = {
                nickname: nickname,
                finalType: finalResultData.title,
                scores: scores
            };

            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', // CORS ì œí•œ ìš°íšŒ
                cache: 'no-cache',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            }).then(() => {
                statusElem.innerText = "âœ“ êµ¬ê¸€ ì‹œíŠ¸ì— ì•ˆì „í•˜ê²Œ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.";
                statusElem.classList.replace('text-slate-400', 'text-emerald-600');
            }).catch(e => {
                statusElem.innerText = "ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                console.error(e);
            });
        }

        window.shareKakao = () => {
            if (!Kakao.isInitialized()) return showToast("ì¹´ì¹´ì˜¤ ì´ˆê¸°í™” ì¤‘...");
            Kakao.Share.sendDefault({
                objectType: 'feed',
                content: {
                    title: `[MPH-TI] ${nickname}ë‹˜ì˜ ë³´ê±´í•™ ì„±í–¥`,
                    description: `ë‚˜ì˜ ìœ í˜•: ${finalResultData.title}\n2026 ë³´ê±´í•™ê³¼ ì‹ ì…ìƒ ì§„ë‹¨ ê²°ê³¼ì…ë‹ˆë‹¤.`,
                    imageUrl: 'https://images.unsplash.com/photo-1576091160550-2173dba999ef?w=500',
                    link: { mobileWebUrl: window.location.href, webUrl: window.location.href },
                },
                buttons: [{ title: 'ë‚˜ë„ í…ŒìŠ¤íŠ¸í•˜ê¸°', link: { mobileWebUrl: window.location.href, webUrl: window.location.href } }],
            });
        };

        window.downloadImage = () => {
            html2canvas(document.getElementById('capture-area')).then(canvas => {
                const link = document.createElement('a');
                link.download = `MPH-TI_${nickname}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        };

        window.showToast = (msg) => {
            const t = document.getElementById('toast');
            t.innerText = msg; t.style.opacity = '1';
            setTimeout(() => t.style.opacity = '0', 2000);
        };

        window.copyToClipboard = () => {
            const text = `${nickname} ì›ìš°ë‹˜ì˜ MPH-TI ìœ í˜•: [${finalResultData.title}]`;
            navigator.clipboard.writeText(text).then(() => showToast("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"));
        };
    </script>
</body>
</html>